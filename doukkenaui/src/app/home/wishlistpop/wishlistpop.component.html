<div class="wishlist-popup shadow rounded" *ngIf="isWishlistOpen">
  <!-- Header -->
  <div class="wishlist-header">
    <h3>My Wishlist ({{ totalItems }})</h3>
    <div class="header-actions">
      <button *ngIf="wishlistItems.length > 0" class="clear-btn" (click)="clearWishlist()" title="Clear All">
        <i class="material-icons">delete_sweep</i> Clear All
      </button>
      <button class="close-btn" (click)="closeWishlist()" title="Close">
        <i class="material-icons">close</i>
      </button>
    </div>
  </div>

  <!-- Success Messages -->
  <div id="success-message" class="success-message" style="display: none;">
    <i class="material-icons">check_circle</i>
    Item added to cart successfully!
  </div>

  <div id="success-all-message" class="success-message" style="display: none;">
    <i class="material-icons">check_circle</i>
    All items added to cart successfully!
  </div>

  <div id="success-remove-message" class="success-message" style="display: none;">
    <i class="material-icons">check_circle</i>
    Item removed from wishlist successfully!
  </div>

  <div id="success-clear-message" class="success-message" style="display: none;">
    <i class="material-icons">check_circle</i>
    Wishlist cleared successfully!
  </div>
  
  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message">
    <i class="material-icons">error</i>
    {{ errorMessage }}
    <button (click)="errorMessage = null" class="dismiss-btn">Ã—</button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Loading your wishlist...</p>
  </div>

  <!-- Not Logged In State -->
  <div *ngIf="!isLoggedIn && !isLoading" class="not-logged-in">
    <div class="login-icon">
      <i class="material-icons">account_circle</i>
    </div>
    <p>Please log in to view your wishlist</p>
    <button (click)="navigateToLogin()" class="login-btn">
      <i class="material-icons">login</i>
      Log In
    </button>
  </div>

  <!-- Empty State -->
  <div *ngIf="isLoggedIn && !isLoading && !errorMessage && wishlistItems.length === 0" class="empty-wishlist">
    <div class="empty-icon">
      <i class="material-icons">favorite_border</i>
    </div>
    <p>Your wishlist is empty</p>
    <p class="empty-subtitle">Add items you love to your wishlist</p>
    <button (click)="navigateToWishlist()" class="browse-btn">
      <i class="material-icons">shopping_bag</i>
      Browse Products
    </button>
  </div>

  <!-- Wishlist Items -->
  <div *ngIf="isLoggedIn && !isLoading && !errorMessage && wishlistItems.length > 0" class="wishlist-content">
    <div class="wishlist-items">
      <div *ngFor="let item of wishlistItems; trackBy: trackByItemId" class="wishlist-item">
        <!-- Item Image -->
        <div class="item-image" (click)="navigateToProduct(item.Id)">
          <img [src]="getImageUrl(item)" [alt]="item.Name" (error)="handleImageError($event)">
        </div>
        
        <!-- Item Details -->
        <div class="item-details">
          <h4 (click)="navigateToProduct(item.Id)" [title]="item.Name">{{ item.Name }}</h4>
          <p class="price">DNT {{ getFormattedPrice(item.Price) }}</p>
          <div class="item-quantity">
            <span>Qty: {{ item.Quantity || 1 }}</span>
          </div>
          <div *ngIf="item.ShortDescription" class="item-description">
            {{ item.ShortDescription }}
          </div>
        </div>
        
        <!-- Item Actions -->
        <div class="item-actions">
          <button (click)="addToCart(item)" 
                  class="cart-btn" 
                  title="Add to Cart"
                  [disabled]="isLoading || isRemoving">
            <i class="material-icons">shopping_cart</i>
          </button>
          <button (click)="removeFromWishlist(item.Id)" 
                  class="remove-btn" 
                  title="Remove from Wishlist"
                  [disabled]="isRemoving">
            <i class="material-icons">delete</i>
            <span *ngIf="isRemoving" class="loading-text">Removing...</span>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Wishlist Summary -->
    <div class="wishlist-summary">
      <div class="summary-row total">
        <span>Subtotal ({{ totalItems }} items)</span>
        <span>DNT {{ getFormattedPrice(subtotal) }}</span>
      </div>
      <div class="action-buttons">
        <button class="add-all-btn" (click)="addAllToCart()" [disabled]="isLoading || isRemoving">
          <i class="material-icons">add_shopping_cart</i>
          Add All to Cart
        </button>
        <button class="view-all-btn" (click)="navigateToWishlist()">
          <i class="material-icons">favorite</i>
          View Full Wishlist
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Backdrop for mobile -->
<div *ngIf="isWishlistOpen" class="wishlist-backdrop" (click)="closeWishlist()"></div>

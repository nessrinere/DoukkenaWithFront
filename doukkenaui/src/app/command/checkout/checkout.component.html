<div class="checkout-page">
  <!-- Order Success Message with Invoice -->
  <div class="order-success" *ngIf="orderPlaced">
    <div class="invoice-container">
      <!-- Invoice Header -->
      <div class="invoice-header">
        <div class="company-info">
          <h1 class="company-name">Doukkena</h1>
          <p class="company-tagline">Your Premium Shopping Destination</p>
        </div>
        <div class="invoice-info">
          <h2 class="invoice-title">INVOICE</h2>
          <div class="invoice-details">
            <div class="detail-row">
              <span class="label">Invoice #:</span>
              <span class="value">INV-{{orderId}}</span>
            </div>
            <div class="detail-row">
              <span class="label">Order ID:</span>
              <span class="value">{{orderId}}</span>
            </div>
            <div class="detail-row">
              <span class="label">Date:</span>
              <span class="value">{{getFormattedOrderDate()}}</span>
            </div>
            <div class="detail-row">
              <span class="label">Status:</span>
              <span class="value status-confirmed">Confirmed</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Success Message -->
      <div class="success-message-section">
        <div class="success-icon">
          <i class="material-icons">check_circle</i>
        </div>
        <h3>Thank You for Your Order!</h3>
        <p>Your order has been placed successfully and is being processed.</p>
      </div>

      <!-- Customer & Shipping Information -->
      <div class="invoice-addresses">
        <div class="billing-address" *ngIf="customerInfo">
          <h4><i class="material-icons">person</i> Customer Information</h4>
          <div class="address-content">
            <p><strong>{{customerInfo.firstName}} {{customerInfo.lastName}}</strong></p>
            <p>{{customerInfo.email}}</p>
            <p *ngIf="customerInfo.phoneNumber">{{customerInfo.phoneNumber}}</p>
          </div>
        </div>
        
        <div class="shipping-address" *ngIf="shippingInfo">
          <h4><i class="material-icons">local_shipping</i> Shipping Address</h4>
          <div class="address-content">
            <p><strong>{{shippingInfo.firstName}} {{shippingInfo.lastName}}</strong></p>
            <p>{{shippingInfo.address}}</p>
            <p>{{shippingInfo.city}}, {{shippingInfo.state}} {{shippingInfo.zipCode}}</p>
            <p>{{shippingInfo.phoneNumber}}</p>
            <p>{{shippingInfo.email}}</p>
          </div>
        </div>
      </div>

      <!-- Order Items Table -->
      <div class="invoice-items">
        <h4><i class="material-icons">shopping_cart</i> Order Items</h4>
        <div class="items-table">
          <div class="table-header">
            <div class="col-item">Item</div>
            <div class="col-qty">Qty</div>
            <div class="col-price">Unit Price</div>
            <div class="col-total">Total</div>
          </div>
          
          <div class="table-row" *ngFor="let item of orderItems">
            <div class="col-item">
              <div class="item-info">
                <img 
                  [src]="getImageUrl(item)" 
                  [alt]="item.Name" 
                  class="item-image"
                >
                <div class="item-details">
                  <p class="item-name">{{item.Name}}</p>
                  <p class="item-description" *ngIf="item.ShortDescription">{{item.ShortDescription}}</p>
                </div>
              </div>
            </div>
            <div class="col-qty">{{item.quantity || 1}}</div>
            <div class="col-price">${{item.Price.toFixed(2)}}</div>
            <div class="col-total">${{(item.Price * (item.quantity || 1)).toFixed(2)}}</div>
          </div>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="invoice-summary">
        <div class="summary-section">
          <h4><i class="material-icons">receipt</i> Order Summary</h4>
          <div class="summary-details">
            <div class="summary-row">
              <span class="label">Subtotal:</span>
              <span class="value">${{getTotal().toFixed(2)}}</span>
            </div>
            <div class="summary-row">
              <span class="label">Tax (7%):</span>
              <span class="value">${{getTax().toFixed(2)}}</span>
            </div>
            <div class="summary-row">
              <span class="label">Shipping:</span>
              <span class="value">${{getShipping().toFixed(2)}}</span>
            </div>
            <div class="summary-row total-row">
              <span class="label">Total Amount:</span>
              <span class="value">${{getFinalTotal().toFixed(2)}}</span>
            </div>
          </div>
        </div>

        <!-- Payment Information -->
        <div class="payment-section">
          <h4><i class="material-icons">payment</i> Payment Information</h4>
          <div class="payment-details">
            <div class="payment-row">
              <span class="label">Payment Method:</span>
              <span class="value">{{selectedPaymentMethod === 'cash' ? 'Cash on Delivery' : selectedPaymentMethod}}</span>
            </div>
            <div class="payment-row">
              <span class="label">Payment Status:</span>
              <span class="value status-pending">Pending</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Invoice Footer -->
      <div class="invoice-footer">
        <div class="footer-notes">
          <h4>Important Notes:</h4>
          <ul>
            <li>You will receive a confirmation email shortly at {{shippingInfo?.email}}</li>
            <li>Your order will be processed within 1-2 business days</li>
            <li>Estimated delivery time: 3-5 business days</li>
            <li>For any questions, please contact our customer service</li>
          </ul>
        </div>
        
        <div class="footer-actions">
          <button class="print-btn" (click)="printInvoice()">
            <i class="material-icons">print</i>
            Print Invoice
          </button>
          <button class="continue-shopping-btn" routerLink="/home/header">
            <i class="material-icons">shopping_bag</i>
            Continue Shopping
          </button>
        </div>
      </div>

      <!-- Thank You Message -->
      <div class="thank-you-section">
        <p class="thank-you-text">Thank you for choosing Doukkena! We appreciate your business.</p>
      </div>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <h3>Processing Your Order</h3>
      <p>Please wait while we process your payment and confirm your order...</p>
    </div>
  </div>

  <!-- Error Message -->
  <div class="error-banner" *ngIf="orderError">
    <div class="error-content">
      <i class="material-icons">error</i>
      <p>{{orderError}}</p>
      <button class="dismiss-btn" (click)="orderError = null">
        <i class="material-icons">close</i>
      </button>
    </div>
  </div>

  <!-- Checkout Form - Only show if order not yet placed -->
  <div class="checkout-container" *ngIf="!orderPlaced">
    <!-- Progress Indicator -->
    <div class="checkout-progress">
      <div class="progress-step active">
        <div class="step-number">1</div>
        <div class="step-label">Shipping</div>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step">
        <div class="step-number">2</div>
        <div class="step-label">Payment</div>
      </div>
      <div class="progress-line"></div>
      <div class="progress-step">
        <div class="step-number">3</div>
        <div class="step-label">Confirmation</div>
      </div>
    </div>

    <!-- Breadcrumb Navigation -->
    <div class="breadcrumb">
      <a routerLink="/home/cart" class="breadcrumb-link">
        <i class="material-icons">shopping_cart</i>
        Cart
      </a>
      <i class="material-icons separator">chevron_right</i>
      <span class="breadcrumb-active">Checkout</span>
    </div>

    <div class="checkout-content">
      <!-- Left Column - Shipping Form -->
      <div class="shipping-section">
        <div class="section-header">
          <h2>Shipping Information</h2>
          <p>Please provide your shipping details to complete your order.</p>
        </div>
        
        <form [formGroup]="shippingForm" class="shipping-form">
          <!-- Personal Information -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="material-icons">person</i>
              Personal Information
            </h3>
            
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First Name*</label>
                <input 
                  type="text" 
                  id="firstName" 
                  formControlName="firstName"
                  placeholder="Enter your first name"
                  [class.error]="isFieldInvalid('firstName')"
                >
                <div class="error-message" *ngIf="isFieldInvalid('firstName')">
                  {{getErrorMessage('firstName')}}
                </div>
              </div>

              <div class="form-group">
                <label for="lastName">Last Name*</label>
                <input 
                  type="text" 
                  id="lastName" 
                  formControlName="lastName"
                  placeholder="Enter your last name"
                  [class.error]="isFieldInvalid('lastName')"
                >
                <div class="error-message" *ngIf="isFieldInvalid('lastName')">
                  {{getErrorMessage('lastName')}}
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="email">Email Address*</label>
                <input 
                  type="email" 
                  id="email" 
                  formControlName="email"
                  placeholder="Enter your email address"
                  [class.error]="isFieldInvalid('email')"
                >
                <div class="error-message" *ngIf="isFieldInvalid('email')">
                  {{getErrorMessage('email')}}
                </div>
              </div>

              <div class="form-group phone-group">
                <label for="phoneNumber">Phone Number*</label>
                <div class="phone-input">
                  <div class="country-code">
                    <i class="material-icons">flag</i>
                 
                  </div>
                  <input 
                    type="tel" 
                    id="phoneNumber" 
                    formControlName="phoneNumber" 
                    placeholder="xxxxxxxx"
                    [class.error]="isFieldInvalid('phoneNumber')"
                  >
                </div>
                <div class="error-message" *ngIf="isFieldInvalid('phoneNumber')">
                  {{getErrorMessage('phoneNumber')}}
                </div>
              </div>
            </div>
          </div>

          <!-- Address Information -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="material-icons">location_on</i>
              Address Information
            </h3>
            
            <div class="form-group full-width">
              <label for="address">Street Address*</label>
              <input 
                type="text" 
                id="address" 
                formControlName="address"
                placeholder="Enter your street address"
                [class.error]="isFieldInvalid('address')"
              >
              <div class="error-message" *ngIf="isFieldInvalid('address')">
                {{getErrorMessage('address')}}
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="city">City*</label>
                <input 
                  type="text" 
                  id="city" 
                  formControlName="city"
                  placeholder="Enter your city"
                  [class.error]="isFieldInvalid('city')"
                >
                <div class="error-message" *ngIf="isFieldInvalid('city')">
                  {{getErrorMessage('city')}}
                </div>
              </div>

              <div class="form-group">
                <label for="state">State/Province*</label>
                <input 
                  type="text" 
                  id="state" 
                  formControlName="state"
                  placeholder="Enter your state"
                  [class.error]="isFieldInvalid('state')"
                >
                <div class="error-message" *ngIf="isFieldInvalid('state')">
                  {{getErrorMessage('state')}}
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="zipCode">ZIP/Postal Code*</label>
              <input 
                type="text" 
                id="zipCode" 
                formControlName="zipCode"
                placeholder="Enter ZIP code"
                [class.error]="isFieldInvalid('zipCode')"
              >
              <div class="error-message" *ngIf="isFieldInvalid('zipCode')">
                {{getErrorMessage('zipCode')}}
              </div>
            </div>
          </div>

          <!-- Additional Information -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="material-icons">note</i>
              Additional Information
            </h3>
            
            <div class="form-group full-width">
              <label for="description">Order Notes (Optional)</label>
              <textarea 
                id="description" 
                rows="3" 
                placeholder="Add any special instructions or notes for your order..."
              ></textarea>
            </div>
          </div>

          <!-- Shipping Method -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="material-icons">local_shipping</i>
              Shipping Method
            </h3>
            
            <div class="shipping-options">
              <div class="shipping-option">
                <input type="radio" id="free-shipping" name="shippingMethod" value="free" checked>
                <label for="free-shipping">
                  <div class="option-content">
                    <div class="option-header">
                      <span class="option-name">Standard Shipping</span>
                      <span class="option-price">Free</span>
                    </div>
                    <span class="option-detail">7-20 business days</span>
                  </div>
                  <div class="option-icon">
                    <i class="material-icons">local_shipping</i>
                  </div>
                </label>
              </div>
              
              <div class="shipping-option">
                <input type="radio" id="express-shipping" name="shippingMethod" value="express">
                <label for="express-shipping">
                  <div class="option-content">
                    <div class="option-header">
                      <span class="option-name">Express Shipping</span>
                      <span class="option-price">DNT 9</span>
                    </div>
                    <span class="option-detail">1-3 business days</span>
                  </div>
                  <div class="option-icon">
                    <i class="material-icons">flash_on</i>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </form>
      </div>

      <!-- Right Column - Order Summary -->
      <div class="order-summary">
        <div class="summary-header">
          <h2>Order Summary</h2>
          <span class="item-count">{{cartItems.length}} item{{cartItems.length !== 1 ? 's' : ''}}</span>
        </div>

        <!-- Cart Items -->
        <div class="cart-items">
          <div class="cart-item" *ngFor="let item of cartItems">
            <div class="item-image">
              <img 
                [src]="getImageUrl(item)" 
                [alt]="item.Name"
              >
              <div class="item-count">{{item.quantity || 1}}</div>
            </div>
            <div class="item-details">
              <h4 class="item-name">{{item.Name}}</h4>
              <p class="item-price">DNT {{item.Price * (item.quantity || 1)}}</p>
            </div>
            <button class="remove-item" title="Remove item">
              <i class="material-icons">close</i>
            </button>
          </div>
        </div>

        <!-- Discount Code -->
        <div class="discount-section">
          <div class="discount-input">
            <input type="text" placeholder="Enter discount code">
            <button class="apply-btn">
              <i class="material-icons">add</i>
              Apply
            </button>
          </div>
        </div>

        <!-- Price Summary -->
        <div class="price-summary">
          <div class="price-row">
            <span>Subtotal</span>
            <span>DNT {{getTotal().toFixed(2)}}</span>
          </div>
          <div class="price-row">
            <span>Shipping</span>
            <span>DNT {{getShipping().toFixed(2)}}</span>
          </div>
          <div class="price-row">
            <span>Tax (7%)</span>
            <span>DNT {{getTax().toFixed(2)}}</span>
          </div>
          <div class="price-row total">
            <span>Total</span>
            <span>DNT {{getFinalTotal().toFixed(2)}}</span>
          </div>
        </div>

        <!-- Security Badge -->
        <div class="security-badge">
          <i class="material-icons">security</i>
          <span>Secure checkout with SSL encryption</span>
        </div>

        <!-- Place Order Button -->
        <button 
          class="place-order-btn" 
          (click)="placeOrder()" 
          [disabled]="cartItems.length === 0 || isLoading || shippingForm.invalid"
        >
          <i class="material-icons" *ngIf="!isLoading">lock</i>
          <div class="spinner" *ngIf="isLoading"></div>
          <span>{{isLoading ? 'Processing...' : 'Place Order'}}</span>
          <span class="total-amount">DNT {{getFinalTotal().toFixed(2)}}</span>
        </button>

        <!-- Return Policy -->
        <div class="return-policy">
          <i class="material-icons">undo</i>
          <p>30-day return policy. Free returns on all orders.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>

